<!DOCTYPE html>
<html>
<head>
    <title>Scheda di presentazione</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!-- CSS -->
    <style type="text/css">
      body{
        text-align: left;
        background-color: white;
      }
      h1{
        text-align: center;
        background-color: white;
      }
      #form{
        margin: 2em;
        float: left;
      }
      #qrcode_container{

        margin-top: 10.5em;
        margin-left: 10em;

        float: left;
        width: 500px;
        height: 500px;
        text-align: center;
        background-color: white;
      }
      #qrcode{
        background-color: white;
        padding: 2em;
      }
    </style>

    <!-- per generazione qr code -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"></script>
    <script type="text/javascript" src="./jquery.qrcode.min.js"></script>

    <!-- per la trasformazione da qr code a pdf -->
    <script type="text/javascript" src="html2canvas.js"></script>

    <!-- Per la creazione del pdf -->
    <script type="text/javascript" src="./jsPDF-1.3.2/dist/jspdf.debug.js"></script>
    <script type="text/javascript">
      /* Funzione di riferimento di html2canvas (non usata). Serve per 
         trasformare un div in un'immagine da salvare nel pdf.
      */
      function genPDF()
      {
         html2canvas(document.getElementById("qrcode"),{
         onrendered:function(canvas){

         var img=canvas.toDataURL("image/png");
         var doc = new jsPDF();
         doc.addImage(img,'JPEG',20,20);
         doc.save('test.pdf');
         }
         });
      }
      function module(nazione, citta, indirizzo, civico){
        this.nazione = nazione;
        this.citta = citta;
        this.indirizzo = indirizzo;
        this.civico = civico;
      }
      function crea_oggetto(){
        var ta;
        var elementiRadioButton = document.getElementsByName("apertura");
        for(var i=0; i<elementiRadioButton.length; i++){
          if(elementiRadioButton[i].checked){
            ta = elementiRadioButton[i].value;
          }
        }

        var nazione = document.getElementById("country").value;
        var citta = document.getElementById("city").value;
        var indirizzo = document.getElementById("address").value;
        var civico = document.getElementById("civic").value;

        var modulo = new module(nazione,citta,indirizzo,civico);
        return modulo;
      }
      function generate_qrcode(){
        var title = document.getElementById("title_qrcode");
        title.firstChild.nodeValue = "QR Code";
        var country = document.getElementById("country").value;
        var city = document.getElementById("city").value;
        var address = document.getElementById("address").value;
        var civic = document.getElementById("civic").value;

        //var componenti_indirizzo = address.split(" ");

        address = address.replace(new RegExp(' ','g'),"%20");
        console.log(address);

        var stringaLink = "https://www.google.com/maps/search/?api=1&query="+civic+"%2C"+address+"%20"+city+"%20"+country;

        console.log(stringaLink);
        jQuery(function(){
        jQuery('#qrcode').qrcode(stringaLink);
        })

        var link = document.getElementById("link");
        link.setAttribute("href",stringaLink);
        link.text=stringaLink;
      }
      var doc;

      function generate_pdf(){
        generate_qrcode();

        
        doc = new jsPDF();
        var mod = crea_oggetto();

        doc.setFontSize(25);
        doc.text(35, 10, 'PDF');


        doc.setFontSize(18);

        doc.text(10, 22, 'Nazione: '+mod.nazione);
        doc.text(10, 32, 'CittÃ : '+mod.citta);
        doc.text(10, 42, 'Indirizzo: '+mod.indirizzo+', '+mod.civico);
        doc.setFontStyle('bold');
        doc.text(10, 52, 'QR Code ');

        html2canvas(document.getElementById("qrcode"),{
          backgroundColor: null,
         onrendered:function(canvas){

         var img=canvas.toDataURL("image/png");
         doc.addImage(img,'PNG',-20,53);
         doc.save('test.pdf'); // Qui viene salvato il pdf
         }
         });
      }
    </script>
</head>
<body>
<h1>QR code generator</h1>
<hr>
  <div>
    <div id="form">
        <p>Nazione: <input id="country"></p>
        <p>Citta: <input id="city"></p>
        <p>Indirizzo: <input id="address"></p>
        <p>Civico: <input id="civic"></p>
      <button onclick="generate_pdf()">SCARICA PDF</button>
    </div>
    <div id="qrcode_container">
        <h3 id="title_qrcode"> </h3>
        <div id="qrcode"></div>
        <br>
        <a id="link"></a>
    </div>
  <div>
</body>
</html>
